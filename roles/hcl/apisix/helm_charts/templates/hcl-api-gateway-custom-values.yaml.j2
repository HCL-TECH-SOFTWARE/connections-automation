# ---------------------------------------------------------------------------
# Custom values for hcl-api-gateway
# Use this file to override default values in values.yaml for your environment.
# ---------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Upstreams configuration
# -----------------------------------------------------------------------------
productUpstreams:
  hcl:
    # -- (string) Name of the default HCL backend upstream
    defaultUpstream: hcl-backend

upstreams:
  # -- (array) List of upstream definitions. Each upstream can have multiple external nodes
  - name: hcl-backend
    # -- (string) Protocol to use for HCL backend (http or https)
    scheme: https
    externalNodes:
      - name: "{{ __frontend_fqdn }}"
        # -- (string) CNX backend URL or domain
        type: Domain
        # -- (string) Node type (Domain or IP)
        port: 443
        # -- (int) Port number for backend

# -----------------------------------------------------------------------------
# Swagger UI configuration
# -----------------------------------------------------------------------------
swaggerUi:
  # -- (bool) Enable Swagger UI for API documentation
  enabled: true
  # -- (int) Number of replicas for Swagger UI deployment
  replicas: 1
  # -- (string) Custom image containing OpenAPI specs
  image: "{{ __docker_registry_url }}/{{ __hcl_api_gateway_image_name }}:{{ __hcl_api_gateway_image_tag }}"
  # -- (string) Image pull policy for Swagger UI
  imagePullPolicy: IfNotPresent
  # -- imagePullSecrets
{% if hcl_api_gateway_image_pull_secret_exists is defined and hcl_api_gateway_image_pull_secret_exists|bool %}
  imagePullSecrets:
    - {{ __hcl_api_gateway_image_pull_secret_name }}
{% endif %}
  # -- (string) Server URL for Swagger UI (should match your APISIX dataplane endpoint)
  serverUrl: "{{ __apisix_swagger_server_url }}"
  # -- (array) List of OpenAPI spec files to include in Swagger UI
  specFiles:
    - name: "Blogs API"
      file: "blogs.yaml"
    - name: "Moderation API"
      file: "moderation.yaml"
  ingress:
    enabled: true
    ingressClass: nginx
    path: {{ __apisix_route_path }}
    tls:
      enabled: true
      secretName: "{{ __ingress_nginx_secret_name }}"
      hosts:
{% if  __ingress_multi_domain_enabled == "true"  %}
        - "*.{{ load_balancer_dns.split('.', 1)[1] }}"
{% if  load_balancer_dns != frontend_fqdn %}
        - "*.{{ frontend_fqdn.split('.', 1)[1] }}"
{% endif %}
{% else %}
        - "{{ cnx_application_ingress }}"
{% endif %}
  service:
    # -- (string) Service type for Swagger UI (e.g., NodePort, ClusterIP)
    type: ClusterIP

apisixTLS:
  enabled: true
  secretName: "{{ __ingress_nginx_secret_name }}"
  hosts:
{% if  __ingress_multi_domain_enabled == "true"  %}
    - "*.{{ load_balancer_dns.split('.', 1)[1] }}"
{% if  load_balancer_dns != frontend_fqdn %}
    - "*.{{ frontend_fqdn.split('.', 1)[1] }}"
{% endif %}
{% else %}
    - "{{ cnx_application_ingress }}"
{% endif %}

ingressClassName: "{{ __apisix_ingress_class }}"