- name:          Get instance id of k8s servers
  get_url:
    url:         http://{{ __aws_service_ep }}/latest/meta-data/instance-id
    dest:        $HOME/ids

- name:          Run command to cat each file and then capture that output.
  shell:         cat $HOME/ids
  register:      cpinstanceids

- name:          delete file from localhost if already exists
  local_action:  file path="$HOME/id_file_cp" state=absent

- name:          Creating an empty file on localhost
  file:
    path:        "$HOME/id_file_cp"
    state:       touch
  delegate_to:   localhost

- name:          copy instance ids to local file
  local_action:  lineinfile line={{ cpinstanceids.stdout }} path="$HOME/id_file_cp" insertafter=EOF

- name:          Run command to cat each file and then capture that output.
  shell:         cat $HOME/id_file_cp
  register:      cpidfile
  delegate_to:   localhost

- set_fact:
    cpinstances: "{{ cpidfile.stdout_lines }}"
