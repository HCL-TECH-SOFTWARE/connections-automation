---
- name:              Check if IHS is already installed
  command:           "egrep {{ __ihs_package_name }} /var/ibm/InstallationManager/installed.xml"
  register:          ihs_already_installed
  ignore_errors:     true

- name:              Extract IHS major version
  set_fact:
    ihs_major_version_installed: "{{ (ihs_already_installed.stdout | regex_search(\"version='([0-9.]+_[0-9]+)\", '\\1'))[0].split('.')[0] }}"
  when:              ihs_already_installed.rc == 0

- name:              Show installed IHS major version
  debug:
    msg:             "Installed IHS major version is: {{ ihs_major_version_installed }}"
  when:              ihs_already_installed.rc == 0

# Set target IHS version for configuration - prefer installed version if available
- name:              Set target IHS version for configuration
  set_fact:
    ihs_target_version: "{{ ihs_major_version_installed | default(__ihs_major_version) }}"

